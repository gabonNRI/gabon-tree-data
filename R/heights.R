library('devtools')
install_github("BIOMASSR/BIOMASS")
install('BIOMASS')
require('BIOMASS')
library("BIOMASS")
install.packages("BIOMASS", repos = "https://cran.opencpu.org", method = "libcurl")

# Sample function that simulates a JSON payload that takes three arguments:
# This payload represents NRI_P005 
testPayloadSimple <- function() {
  D <- 10:19
  WD <- runif(length(D), min = 0.1, max = 1)
  H <- D^(2/3)
  # If you have height data
  AGB <- computeAGB(D,WD,H)
}
testPayload <- function() {
  tagAndDiameterWithHeightsJSON = '
{ "latitude": -2.8433055556, "longitude": 11.57453, "trees": 
[ {  "Tag": "3407", "D": 40.8, "H": 15.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
 {  "Tag": "3408", "D": 14.6, "H": 6.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.40890000000000004 },
  {  "Tag": "3409", "D": 14.5, "H": 5.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.915 },
  {  "Tag": "3410", "D": 39.7, "H": 7.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3411", "D": 14.7, "H": 3.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
{  "Tag": "3412", "D": 15.7, "H": 4.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3413", "D": 11.8, "H": 6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3414", "D": 11.4, "H": 3.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3415", "D": 74.7, "H": 19.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3416", "D": 27.2, "H": 19.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3417", "D": 13.2, "H": 5.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3418", "D": 34.2, "H": 12.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3419", "D": 14.4, "H": 3.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3420", "D": 33.5, "H": 15.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3421", "D": 12.4, "H": 4.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5124000000000001 },
  {  "Tag": "3422", "D": 72, "H": 23.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3423", "D": 11, "H": 5.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  {  "Tag": "3427", "D": 24.9, "H": 14.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3432", "D": 20.3, "H": 19.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  {  "Tag": "3438", "D": 45.7, "H": 11.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3441", "D": 40.4, "H": 12.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3451", "D": 24.9, "H": 9.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3458", "D": 25.7, "H": 18.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6577857142857144 },
  {  "Tag": "3461", "D": 37.5, "H": 10.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5567999999999999 },
  {  "Tag": "3467", "D": 76.7, "H": 37.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3468", "D": 44.7, "H": 12.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3474", "D": 31.4, "H": 15.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3483", "D": 42.8, "H": 20.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.24283333333333332 },
  {  "Tag": "3484", "D": 22.6, "H": 14.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3487", "D": 76.2, "H": 41.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3489", "D": 44.7, "H": 21.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.749 },
  {  "Tag": "3501", "D": 24.3, "H": 15.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3502", "D": 65.3, "H": 25.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  {  "Tag": "3504", "D": 20.7, "H": 10.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3510", "D": 25.8, "H": 18.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3522", "D": 30.9, "H": 18.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3523", "D": 30.6, "H": 16, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3529", "D": 30.5, "H": 16, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  {  "Tag": "3530", "D": 29.5, "H": 16.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 }
]}'
 
foo = '[{ "Tag": "3424",  "D": 11.2,  "latitude": -2.84330555555556,  "longitude": 11.57453,  "WD": 0.553 },
  { "Tag": "3425",  "D": 10.6,  "latitude": -2.84330555555556,  "longitude": 11.57453,  "WD": 0.553 },
  { "Tag": "3426",  "D": 10.6,  "latitude": -2.84330555555556,  "longitude": 11.57453,  "WD": 0.35786558862981777 },
  { "Tag": "3428",  "D": 10, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3429", "D": 17.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  { "Tag": "3430", "D": 15.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  { "Tag": "3431", "D": 14.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  { "Tag": "3433", "D": 19.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3434", "D": 18.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3435", "D": 10.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.40890000000000004 },
  { "Tag": "3436", "D": 10.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3437", "D": 10.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3439", "D": 16.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3440", "D": 14.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3442", "D": 12.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3443", "D": 11, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3444", "D": 11.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6577857142857144 },
  { "Tag": "3445", "D": 18.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6577857142857144 },
  { "Tag": "3446", "D": 15.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3447", "D": 15.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6577857142857144 },
  { "Tag": "3448", "D": 12, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3449", "D": 15.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3450", "D": 12.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3452", "D": 13.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3453", "D": 15.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3454", "D": 10.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3455", "D": 10.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5463333333333332 },
  { "Tag": "3456", "D": 11.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3457", "D": 11.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5124000000000001 },
  { "Tag": "3459", "D": 10.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3460", "D": 14.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3462", "D": 12.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.38875 },
  { "Tag": "3463", "D": 10.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.38875 },
  { "Tag": "3464", "D": 10.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.38875 },
  { "Tag": "3465", "D": 10.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3466", "D": 13.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3469", "D": 14.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3470", "D": 10.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6577857142857144 },
  { "Tag": "3471", "D": 11.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3472", "D": 12.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6444 },
  { "Tag": "3473", "D": 12.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6444 },
  { "Tag": "3475", "D": 16.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3476", "D": 10, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3477", "D": 10.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3478", "D": 11.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3479", "D": 10, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3480", "D": 11, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3481", "D": 14.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3482", "D": 11.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3485", "D": 10.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3486", "D": 14.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5124000000000001 },
  { "Tag": "3488", "D": 18.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3490", "D": 18.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3491", "D": 12.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3492", "D": 19.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3493", "D": 18.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3494", "D": 10.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.38875 },
  { "Tag": "3495", "D": 19.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3496", "D": 11.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.40890000000000004 },
  { "Tag": "3497", "D": 18.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3498", "D": 12.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3499", "D": 12.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3500", "D": 12.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3503", "D": 10.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3505", "D": 18.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3506", "D": 10.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3507", "D": 12.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3508", "D": 16.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3509", "D": 11.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5544647887323942 },
  { "Tag": "3511", "D": 14.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3512", "D": 12.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3513", "D": 17.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3514", "D": 13.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3515", "D": 13.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3516", "D": 23.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3517", "D": 10.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3518", "D": 14.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3519", "D": 14, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3520", "D": 22.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3521", "D": 19.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3524", "D": 13.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3525", "D": 11.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3526", "D": 11, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3527", "D": 13.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3528", "D": 10, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "3531", "D": 10.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.35786558862981777 },
  { "Tag": "3532", "D": 14.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "Aux_C_0", "D": 11.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  { "Tag": "Aux_C_1", "D": 10.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  { "Tag": "Aux_C_2", "D": 10.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  { "Tag": "Aux_C_3", "D": 12, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  { "Tag": "Aux_C_4", "D": 13.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  { "Tag": "Aux_C_5", "D": 19.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  { "Tag": "Aux_C_6", "D": 10.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  { "Tag": "Aux_C_7", "D": 10.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  { "Tag": "Aux_C_8", "D": 10, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.553 },
  { "Tag": "Aux_C_9", "D": 10, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.663 },
  { "Tag": "Aux_C_10", "D": 104, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_11", "D": 13.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.915 },
  { "Tag": "Aux_C_12", "D": 10.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.38875 },
  { "Tag": "Aux_C_13", "D": 13.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_14", "D": 34.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "Aux_C_15", "D": 12.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_16", "D": 22, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6760909090909091 },
  { "Tag": "Aux_C_17", "D": 17.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_18", "D": 22.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_19", "D": 11.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_20", "D": 10.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.663 },
  { "Tag": "Aux_C_21", "D": 11.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_22", "D": 11, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.915 },
  { "Tag": "Aux_C_23", "D": 14.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.915 },
  { "Tag": "Aux_C_24", "D": 11, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_25", "D": 14.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.915 },
  { "Tag": "Aux_C_26", "D": 36.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_27", "D": 23.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_28", "D": 19.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_29", "D": 10.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_30", "D": 15.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_31", "D": 15.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_32", "D": 74.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_33", "D": 11.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6577857142857144 },
  { "Tag": "Aux_C_34", "D": 33.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.24283333333333332 },
  { "Tag": "Aux_C_35", "D": 12.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_36", "D": 45.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.24283333333333332 },
  { "Tag": "Aux_C_37", "D": 39.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "Aux_C_38", "D": 44, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6760909090909091 },
  { "Tag": "Aux_C_39", "D": 40, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_40", "D": 15.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_41", "D": 17.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.38875 },
  { "Tag": "Aux_C_42", "D": 26.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_C_43", "D": 24.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_44", "D": 22.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_45", "D": 10.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.38875 },
  { "Tag": "Aux_D_46", "D": 12.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_47", "D": 51.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "Aux_D_48", "D": 11.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_49", "D": 12.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_50", "D": 13.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_51", "D": 11, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_52", "D": 38.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_53", "D": 15.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_54", "D": 12.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_55", "D": 12.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_56", "D": 84.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_57", "D": 13.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_58", "D": 18.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_59", "D": 25.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_60", "D": 45, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_61", "D": 12.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_62", "D": 21.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_63", "D": 48, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.21059999999999998 },
  { "Tag": "Aux_D_64", "D": 10, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.38875 },
  { "Tag": "Aux_D_65", "D": 13.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.38875 },
  { "Tag": "Aux_D_66", "D": 19.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.4524642857142857 },
  { "Tag": "Aux_D_67", "D": 10, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.4524642857142857 },
  { "Tag": "Aux_D_68", "D": 11.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_69", "D": 16.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.24283333333333332 },
  { "Tag": "Aux_D_70", "D": 11.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.4524642857142857 },
  { "Tag": "Aux_D_71", "D": 21.1, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_72", "D": 13.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_73", "D": 11, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_74", "D": 15, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_75", "D": 15.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_76", "D": 14, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_77", "D": 28.3, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_78", "D": 19.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6760909090909091 },
  { "Tag": "Aux_D_79", "D": 16, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6760909090909091 },
  { "Tag": "Aux_D_80", "D": 14.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_81", "D": 14.7, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_82", "D": 18.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_83", "D": 34.4, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.24283333333333332 },
  { "Tag": "Aux_D_84", "D": 19.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_85", "D": 21.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.40890000000000004 },
  { "Tag": "Aux_D_86", "D": 18.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_87", "D": 26.8, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_88", "D": 14.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.4524642857142857 },
  { "Tag": "Aux_D_89", "D": 66.5, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.915 },
  { "Tag": "Aux_D_90", "D": 11.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_91", "D": 11.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_92", "D": 17.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 },
  { "Tag": "Aux_D_93", "D": 11.6, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.6760909090909091 },
  { "Tag": "Aux_D_94", "D": 10.2, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.40890000000000004 },
  { "Tag": "Aux_D_95", "D": 13.9, "latitude": -2.84330555555556, "longitude": 11.57453, "WD": 0.5195458716080666 } ]
  
  '
  eValue = 0.0358
  receiveHeightsPayload(tagAndDiameterWithHeightsJSON, eValue)
}
receiveHeightsPayload <- function(tagAndDiameterWithHeightsJSON, eValue) {
  library(jsonlite)
  tagAndDiameterWithHeightsFrame = fromJSON(tagAndDiameterWithHeightsJSON)
  #print(tagAndDiameterWithHeightsFrame)
  #unheightedDiameterFrame = fromJSON(unheightedDiameterJSON)
  latitude = tagAndDiameterWithHeightsFrame$latitude
  longitude = tagAndDiameterWithHeightsFrame$longitude
  coordinates = cbind(longitude, latitude)
  #answer = tagAndDiameterWithHeightsFrame
  answer = computeAGB(tagAndDiameterWithHeightsFrame$trees$D, tagAndDiameterWithHeightsFrame$trees$WD, tagAndDiameterWithHeightsFrame$trees$H, coordinates)
  #answer = computeHeights(tagAndDiameterWithHeightsFrame, unheightedDiameterFrame, eValue)
  toJSON(answer)
  
}

computeHeights <-
  function(tagAndDiameterWithHeightsFrame, unheightedDiameterFrame, eValue = -0.059)
  {
    fit <- heightfit(hdat = tagAndDiameterWithHeightsFrame,
                     sub.dat = unheightedDiameterFrame,
                     E_Value = eValue)
    unheightedDiameterFrame$Ht <- fit$predht
    
    DiameterHeightFrame <- unheightedDiameterFrame
    DH_vars <- fit$vars
    DH_equation <- formula(paste("y ~ ", fit$Xequ, sep = ""))
    #DH_equ2 <- substitute(expr = DH_equation, list(a = DH_vars[1], b = DH_vars[2]))
    DH_equ3 <- gsub("a", round(DH_vars[1], 3), DH_equation)
    DH_equ3 <- gsub("b", round(DH_vars[2], 3), DH_equ3)
    DH_equ3 <- gsub("c", round(DH_vars[3], 3), DH_equ3)
    DH_equ3 <- gsub("d", round(DH_vars[4], 3), DH_equ3)
    DH_equ3 <- formula(paste("y ~ ", DH_equ3[3], sep = ""))
    payload <- list(unheightedDiameterFrame, 
                    Reduce(paste, deparse(DH_equation, width.cutoff = 500)), 
                    Reduce(paste, deparse(DH_equ3, width.cutoff = 500)))
    
    payload
    
    

  }

autorun <- testPayload()
simple <- testPayloadSimple()
